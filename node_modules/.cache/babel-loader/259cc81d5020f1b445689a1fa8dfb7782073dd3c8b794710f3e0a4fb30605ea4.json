{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = upload;\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\nfunction getError(action, option, xhr) {\n  var msg = void 0;\n  if (xhr.response) {\n    msg = xhr.status + ' ' + (xhr.response.error || xhr.response);\n  } else if (xhr.responseText) {\n    msg = xhr.status + ' ' + xhr.responseText;\n  } else {\n    msg = 'fail to post ' + action + ' ' + xhr.status;\n  }\n  var err = new Error(msg);\n  err.status = xhr.status;\n  err.method = 'post';\n  err.url = action;\n  return err;\n}\nfunction getBody(xhr) {\n  var text = xhr.responseText || xhr.response;\n  if (!text) {\n    return text;\n  }\n  try {\n    return JSON.parse(text);\n  } catch (e) {\n    return text;\n  }\n}\nfunction upload(option) {\n  if (typeof XMLHttpRequest === 'undefined') {\n    return;\n  }\n  var xhr = new XMLHttpRequest();\n  var action = option.action;\n  if (xhr.upload) {\n    xhr.upload.onprogress = function progress(e) {\n      if (e.total > 0) {\n        e.percent = e.loaded / e.total * 100;\n      }\n      option.onProgress(e);\n    };\n  }\n  var formData = new FormData();\n  if (option.data) {\n    Object.keys(option.data).map(function (key) {\n      formData.append(key, option.data[key]);\n    });\n  }\n  formData.append(option.filename, option.file);\n  xhr.onerror = function error(e) {\n    option.onError(e);\n  };\n  xhr.onload = function onload() {\n    if (xhr.status < 200 || xhr.status >= 300) {\n      return option.onError(getError(action, option, xhr));\n    }\n    option.onSuccess(getBody(xhr));\n  };\n  xhr.open('post', action, true);\n  if (option.withCredentials && 'withCredentials' in xhr) {\n    xhr.withCredentials = true;\n  }\n  var headers = option.headers || {};\n  for (var item in headers) {\n    if (headers.hasOwnProperty(item) && headers[item] !== null) {\n      xhr.setRequestHeader(item, headers[item]);\n    }\n  }\n  xhr.send(formData);\n  return xhr;\n}\n;\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n  if (!reactHotLoader) {\n    return;\n  }\n  reactHotLoader.register(getError, 'getError', 'src/upload/ajax.js');\n  reactHotLoader.register(getBody, 'getBody', 'src/upload/ajax.js');\n  reactHotLoader.register(upload, 'upload', 'src/upload/ajax.js');\n})();\n;\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"names":["Object","defineProperty","exports","value","default","upload","enterModule","reactHotLoaderGlobal","require","module","getError","action","option","xhr","msg","response","status","error","responseText","err","Error","method","url","getBody","text","JSON","parse","e","XMLHttpRequest","onprogress","progress","total","percent","loaded","onProgress","formData","FormData","data","keys","map","key","append","filename","file","onerror","onError","onload","onSuccess","open","withCredentials","headers","item","hasOwnProperty","setRequestHeader","send","reactHotLoader","register","leaveModule"],"sources":["/Users/mickey/document/Work/ToilBuster/agile-project/node_modules/element-react/dist/npm/es5/src/upload/ajax.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = upload;\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\nfunction getError(action, option, xhr) {\n  var msg = void 0;\n  if (xhr.response) {\n    msg = xhr.status + ' ' + (xhr.response.error || xhr.response);\n  } else if (xhr.responseText) {\n    msg = xhr.status + ' ' + xhr.responseText;\n  } else {\n    msg = 'fail to post ' + action + ' ' + xhr.status;\n  }\n\n  var err = new Error(msg);\n  err.status = xhr.status;\n  err.method = 'post';\n  err.url = action;\n  return err;\n}\n\nfunction getBody(xhr) {\n  var text = xhr.responseText || xhr.response;\n  if (!text) {\n    return text;\n  }\n\n  try {\n    return JSON.parse(text);\n  } catch (e) {\n    return text;\n  }\n}\n\nfunction upload(option) {\n  if (typeof XMLHttpRequest === 'undefined') {\n    return;\n  }\n\n  var xhr = new XMLHttpRequest();\n  var action = option.action;\n\n  if (xhr.upload) {\n    xhr.upload.onprogress = function progress(e) {\n      if (e.total > 0) {\n        e.percent = e.loaded / e.total * 100;\n      }\n      option.onProgress(e);\n    };\n  }\n\n  var formData = new FormData();\n\n  if (option.data) {\n    Object.keys(option.data).map(function (key) {\n      formData.append(key, option.data[key]);\n    });\n  }\n\n  formData.append(option.filename, option.file);\n\n  xhr.onerror = function error(e) {\n    option.onError(e);\n  };\n\n  xhr.onload = function onload() {\n    if (xhr.status < 200 || xhr.status >= 300) {\n      return option.onError(getError(action, option, xhr));\n    }\n\n    option.onSuccess(getBody(xhr));\n  };\n\n  xhr.open('post', action, true);\n\n  if (option.withCredentials && 'withCredentials' in xhr) {\n    xhr.withCredentials = true;\n  }\n\n  var headers = option.headers || {};\n\n  for (var item in headers) {\n    if (headers.hasOwnProperty(item) && headers[item] !== null) {\n      xhr.setRequestHeader(item, headers[item]);\n    }\n  }\n  xhr.send(formData);\n  return xhr;\n}\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(getError, 'getError', 'src/upload/ajax.js');\n  reactHotLoader.register(getBody, 'getBody', 'src/upload/ajax.js');\n  reactHotLoader.register(upload, 'upload', 'src/upload/ajax.js');\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}